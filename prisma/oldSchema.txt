generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model brand {
  brandId           Int        @id @default(autoincrement())
  brandName         String?    @unique
  description       String?
  country           String?
  isActive          Boolean?   @default(true)
  createdAt         DateTime?  @default(now())
  createdBy         Int
  updatedAt         DateTime?  @default(now())
  updatedBy         Int
  deletedAt         DateTime?
  deletedBy         Int?
  createdByEmployee employees  @relation("brand_createdBy", fields: [createdBy], references: [EmployeeID])
  deletedByEmployee employees? @relation("brand_deletedBy", fields: [deletedBy], references: [EmployeeID])
  updatedByEmployee employees  @relation("brand_updatedBy", fields: [updatedBy], references: [EmployeeID])
  model             model[]
  product           product[]

  @@map("brand")
}

model category {
  categoryId        Int        @id @default(autoincrement())
  categoryName      String?
  description       String?
  isActive          Boolean?   @default(true)
  createdAt         DateTime?  @default(now())
  createdBy         Int
  updatedAt         DateTime?  @default(now())
  updatedBy         Int
  deletedAt         DateTime?
  deletedBy         Int?
  mainCategory      String?
  createdByEmployee employees  @relation("category_createdBy", fields: [createdBy], references: [EmployeeID])
  deletedByEmployee employees? @relation("category_deletedBy", fields: [deletedBy], references: [EmployeeID])
  updatedByEmployee employees  @relation("category_updatedBy", fields: [updatedBy], references: [EmployeeID])
  product           product[]

  @@map("category")
}

model employees {
  EmployeeID               Int              @id @default(autoincrement())
  Email                    String           @unique
  Phone                    String?
  UserName                 String           @unique
  Password                 String
  RoleID                   Int
  CreatedBy                Int?
  CreatedDate              DateTime?        @default(now())
  
  // Brand relations
  brand_createdBy          brand[]          @relation("brand_createdBy")
  brand_deletedBy          brand[]          @relation("brand_deletedBy")
  brand_updatedBy          brand[]          @relation("brand_updatedBy")
  
  // Category relations
  category_createdBy       category[]       @relation("category_createdBy")
  category_deletedBy       category[]       @relation("category_deletedBy")
  category_updatedBy       category[]       @relation("category_updatedBy")
  
  // Model relations
  model_createdBy          model[]          @relation("model_createdBy")
  model_deletedBy          model[]          @relation("model_deletedBy")
  model_updatedBy          model[]          @relation("model_updatedBy")
  
  // Product relations
  product_createdBy        product[]        @relation("product_createdBy")
  product_deletedBy        product[]        @relation("product_deletedBy")
  product_updatedBy        product[]        @relation("product_updatedBy")
  
  // Product version relations
  productversion_createdBy productversion[] @relation("productVersion_createdBy")
  productversion_deletedBy productversion[] @relation("productVersion_deletedBy")
  productversion_updatedBy productversion[] @relation("productVersion_updatedBy")
  
  // Supplier relations
  supplier_createdBy       supplier[]       @relation("supplier_createdBy")
  supplier_deletedBy       supplier[]       @relation("supplier_deletedBy")
  supplier_updatedBy       supplier[]       @relation("supplier_updatedBy")
  
  // Other relations - FIXED RELATION NAMES
  bincard                  bincard[]        @relation("employee_bincard")
  transactionLog           transactionLog[] @relation("employee_transactionLog")
  grn                      grn[]            @relation("employee_grn")
  gin                      gin[]            @relation("employee_gin")

  @@map("employees")
}

model model {
  modelId           Int        @id @default(autoincrement())
  modelName         String?
  description       String?
  brandId           Int
  isActive          Boolean?   @default(true)
  createdAt         DateTime?  @default(now())
  createdBy         Int
  updatedAt         DateTime?  @default(now())
  updatedBy         Int
  deletedAt         DateTime?
  deletedBy         Int?
  brand             brand      @relation(fields: [brandId], references: [brandId])
  createdByEmployee employees  @relation("model_createdBy", fields: [createdBy], references: [EmployeeID])
  deletedByEmployee employees? @relation("model_deletedBy", fields: [deletedBy], references: [EmployeeID])
  updatedByEmployee employees  @relation("model_updatedBy", fields: [updatedBy], references: [EmployeeID])
  product           product[]

  @@map("model")
}

model product {
  productId         Int               @id @default(autoincrement())
  sku               String?           @unique
  productName       String?
  description       String?
  categoryId        Int
  brandId           Int
  modelId           Int
  createdBy         Int
  supplierId        Int
  isActive          Boolean?          @default(true)
  createdAt         DateTime?         @default(now())
  updatedAt         DateTime?         @updatedAt
  updatedBy         Int?
  deletedBy         Int?
  deletedAt         DateTime?
  brand             brand             @relation(fields: [brandId], references: [brandId])
  category          category          @relation(fields: [categoryId], references: [categoryId])
  createdByEmployee employees         @relation("product_createdBy", fields: [createdBy], references: [EmployeeID])
  deletedByEmployee employees?        @relation("product_deletedBy", fields: [deletedBy], references: [EmployeeID])
  model             model             @relation(fields: [modelId], references: [modelId])
  supplier          supplier          @relation(fields: [supplierId], references: [supplierId])
  updatedByEmployee employees?        @relation("product_updatedBy", fields: [updatedBy], references: [EmployeeID])
  productSupplier   productsupplier[]
  productVersion    productversion[]
  
  // FIXED RELATION NAMES
  grnDetails        grnDetails[]      @relation("product_grnDetails")
  ginDetails        ginDetails[]      @relation("product_ginDetails")
  stock             stock[]           @relation("product_stock")

  @@map("product")
}

model productsupplier {
  productSupplierId Int       @id
  productId         Int
  supplierId        Int
  startDate         DateTime?
  endDate           DateTime?
  isPrimarySupplier Boolean?
  status            String?
  createdBy         Int?
  createdAt         DateTime?
  updatedBy         Int?
  updatedAt         DateTime?
  deletedBy         Int?
  deletedAt         DateTime?
  product           product   @relation(fields: [productId], references: [productId])
  supplier          supplier  @relation(fields: [supplierId], references: [supplierId])

  @@map("productsupplier")
}

model productvariation {
  variationId   Int            @id @default(autoincrement())
  versionId     Int
  variationName String?
  color         String?
  size          String?
  capacity      String?
  barcode       String?
  price         Decimal?
  quantity      Int?
  minStockLevel Int?
  maxStockLevel Int?
  isActive      Boolean?       @default(true)
  createdBy     Int?
  createdAt     DateTime?      @default(now())
  updatedBy     Int?
  updatedAt     DateTime?      @updatedAt
  deletedBy     Int?
  deletedAt     DateTime?
  version       productversion @relation(fields: [versionId], references: [versionId])
  specdetails   specdetails[]
  
  // FIXED RELATION NAMES
  bincard       bincard[]      @relation("variation_bincard")
  stock         stock[]        @relation("variation_stock")

  @@map("productvariation")
}

model productversion {
  versionId         Int                @id @default(autoincrement())
  productId         Int
  versionNumber     String?
  releaseDate       DateTime?
  isActive          Boolean?           @default(true)
  createdBy         Int?
  createdAt         DateTime?          @default(now())
  updatedBy         Int?
  updatedAt         DateTime?          @updatedAt
  deletedBy         Int?
  deletedAt         DateTime?
  variations        productvariation[]
  createdByEmployee employees?         @relation("productVersion_createdBy", fields: [createdBy], references: [EmployeeID])
  deletedByEmployee employees?         @relation("productVersion_deletedBy", fields: [deletedBy], references: [EmployeeID])
  product           product            @relation(fields: [productId], references: [productId])
  updatedByEmployee employees?         @relation("productVersion_updatedBy", fields: [updatedBy], references: [EmployeeID])

  @@map("productversion")
}

model roles {
  RoleID      Int     @id @default(autoincrement())
  RoleName    String
  Description String?

  @@map("roles")
}

model specs {
  specId      Int           @id @default(autoincrement())
  specName    String?
  createdBy   Int?
  createdAt   DateTime?
  updatedBy   Int?
  updatedAt   DateTime?
  deletedBy   Int?
  deletedAt   DateTime?
  specdetails specdetails[]

  @@map("specs")
}

model specdetails {
  specDetailId Int              @id @default(autoincrement())
  variationId  Int
  specId       Int
  specValue    String?
  createdBy    Int?
  createdAt    DateTime?        @default(now())
  updatedBy    Int?
  updatedAt    DateTime?        @updatedAt
  deletedBy    Int?
  deletedAt    DateTime?
  spec         specs            @relation(fields: [specId], references: [specId])
  variation    productvariation @relation(fields: [variationId], references: [variationId])

  @@map("specdetails")
}

model supplier {
  supplierId        Int               @id @default(autoincrement())
  supplierName      String?
  contactPerson     String?
  email             String?
  phone             String?
  address           String?
  city              String?
  country           String?
  isActive          Boolean?          @default(true)
  createdAt         DateTime?         @default(now())
  createdBy         Int
  updatedAt         DateTime?         @default(now())
  updatedBy         Int
  deletedAt         DateTime?
  deletedBy         Int?
  product           product[]
  productsupplier   productsupplier[]
  createdByEmployee employees         @relation("supplier_createdBy", fields: [createdBy], references: [EmployeeID])
  deletedByEmployee employees?        @relation("supplier_deletedBy", fields: [deletedBy], references: [EmployeeID])
  updatedByEmployee employees         @relation("supplier_updatedBy", fields: [updatedBy], references: [EmployeeID])
  
  // FIXED RELATION NAME
  grn               grn[]             @relation("supplier_grn")

  @@map("supplier")
}

model bincard {
  binCardId       Int              @id @default(autoincrement()) @map("BinCardID")
  variationId     Int              @map("VariationID")
  transactionDate DateTime?        @map("TransactionDate")
  transactionType String?          @map("TransactionType")
  referenceId     Int?             @map("ReferenceID")
  quantityIn      Int?             @map("QuantityIn")
  quantityOut     Int?             @map("QuantityOut")
  balance         Int?             @map("Balance")
  employeeId      Int              @map("EmployeeID")
  remarks         String?          @map("Remarks")

  // Relations - FIXED WITH CORRECT RELATION NAMES
  variation productvariation @relation("variation_bincard", fields: [variationId], references: [variationId])
  employee  employees        @relation("employee_bincard", fields: [employeeId], references: [EmployeeID])

  @@map("BinCard")
}

model transactionLog {
  logId       Int       @id @default(autoincrement()) @map("LogID")
  employeeId  Int       @map("EmployeeID")
  actionType  String?   @map("ActionType")
  entityName  String?   @map("EntityName")
  referenceId Int?      @map("ReferenceID")
  actionDate  DateTime? @map("ActionDate")
  oldValue    String?   @map("OldValue")
  newValue    String?   @map("NewValue")

  // Relations - FIXED WITH CORRECT RELATION NAME
  employee employees @relation("employee_transactionLog", fields: [employeeId], references: [EmployeeID])

  @@map("TransactionLog")
}

model grn {
  grnId        Int          @id @default(autoincrement()) @map("GRN_ID")
  grnNumber    String?      @unique @map("GRN_Number")
  supplierId   Int          @map("SupplierID")
  employeeId   Int          @map("EmployeeID")
  receivedDate DateTime?    @map("ReceivedDate")
  totalAmount  Decimal?     @map("TotalAmount")
  remarks      String?      @map("Remarks")
  createdDate  DateTime?    @map("CreatedDate")
  updatedDate  DateTime?    @map("UpdatedDate")
  stockId      Int?         @map("StockID")

  // Relations - FIXED WITH CORRECT RELATION NAMES
  supplier supplier   @relation("supplier_grn", fields: [supplierId], references: [supplierId])
  employee employees  @relation("employee_grn", fields: [employeeId], references: [EmployeeID])
  stock    stock?     @relation("stock_grn", fields: [stockId], references: [stockId])

  details grnDetails[]

  @@map("GRN")
}

model grnDetails {
  grnDetailId      Int      @id @default(autoincrement()) @map("GRNDetailID")
  grnId            Int      @map("GRN_ID")
  productId        Int      @map("ProductID")
  quantityReceived Int?     @map("QuantityReceived")
  unitCost         Decimal? @map("UnitCost")
  subTotal         Decimal? @map("SubTotal")
  location         Int?     @map("Location")

  // Relations - FIXED WITH CORRECT RELATION NAME
  grn     grn     @relation(fields: [grnId], references: [grnId])
  product product @relation("product_grnDetails", fields: [productId], references: [productId])

  @@map("GRNDetails")
}

model gin {
  ginId       Int          @id @default(autoincrement()) @map("GIN_ID")
  ginNumber   String?      @unique @map("GIN_Number")
  employeeId  Int          @map("EmployeeID")
  issuedTo    String?      @map("IssuedTo")
  issueReason String?      @map("IssueReason")
  issueDate   DateTime?    @map("IssueDate")
  remarks     String?      @map("Remarks")
  createdDate DateTime?    @map("CreatedDate")
  updatedDate DateTime?    @map("UpdatedDate")
  stockId     Int?         @map("StockID")

  // Relations - FIXED WITH CORRECT RELATION NAMES
  employee employees @relation("employee_gin", fields: [employeeId], references: [EmployeeID])
  stock    stock?    @relation("stock_gin", fields: [stockId], references: [stockId])

  details ginDetails[]

  @@map("GIN")
}

model ginDetails {
  ginDetailId    Int      @id @default(autoincrement()) @map("GINDetailID")
  ginId          Int      @map("GIN_ID")
  productId      Int      @map("ProductID")
  quantityIssued Int?     @map("QuantityIssued")
  unitCost       Decimal? @map("UnitCost")
  subTotal       Decimal? @map("SubTotal")
  location       Int?     @map("Location")

  // Relations - FIXED WITH CORRECT RELATION NAME
  gin     gin     @relation(fields: [ginId], references: [ginId])
  product product @relation("product_ginDetails", fields: [productId], references: [productId])

  @@map("GINDetails")
}

model stock {
  stockId           Int               @id @default(autoincrement()) @map("StockID")
  productId         Int               @map("ProductID")
  quantityAvailable Int?              @map("QuantityAvailable")
  reorderLevel      Int?              @map("ReorderLevel")
  lastUpdatedDate   DateTime?         @map("LastUpdatedDate")
  variationId       Int?              @map("VariationID")
  location          String?           @map("Location")

  // Relations - FIXED WITH CORRECT RELATION NAMES AND OPTIONAL VARIATION
  product   product            @relation("product_stock", fields: [productId], references: [productId])
  variation productvariation? @relation("variation_stock", fields: [variationId], references: [variationId])
  grn       grn[]             @relation("stock_grn")
  gin       gin[]             @relation("stock_gin")

  @@map("Stock")
}